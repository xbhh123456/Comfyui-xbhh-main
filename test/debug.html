<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Live2D V2 调试 (本地服务器版)</title>
    <style>
        body { margin: 0; padding: 20px; background: #222; color: #eee; font-family: sans-serif; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; }
        .alert { padding: 15px; background: #442222; border-left: 5px solid #ff5555; margin-bottom: 20px; }
        code { background: #000; padding: 2px 5px; border-radius: 3px; color: #ff7a7a; }
        .steps { background: #333; padding: 20px; border-radius: 8px; border: 1px solid #444; }
        button { padding: 10px 20px; cursor: pointer; background: #555; color: white; border: none; border-radius: 4px; }
        button:hover { background: #666; }
        #waifu-status { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Live2D V2 独立调试模式</h1>
        
        <div class="alert">
            <strong>注意：</strong> 由于浏览器安全策略（CORS），此页面<b>不能</b>直接双击 HTML 文件打开。必须通过本地 HTTP 服务器运行。
        </div>

        <div class="steps">
            <h3>启动步骤：</h3>
            <ol>
                <li>在文件夹 <code>e:\桌面\1\xbhh-lora\test</code> 下打开 PowerShell。</li>
                <li>执行以下任一命令启动服务器：
                    <ul>
                        <li>如果你安装了 Python：<code>python -m http.server 8989</code></li>
                        <li>如果你安装了 Node.js：<code>npx serve</code> 或 <code>npx http-server</code></li>
                    </ul>
                </li>
                <li>在浏览器访问：<a href="http://localhost:8989/debug.html" style="color:#00daff">http://localhost:8989/debug.html</a></li>
            </ol>
        </div>

        <div id="waifu-status">资源加载状态：<span id="load-info">等待中...</span></div>
    </div>

    <!-- 模拟渲染容器 -->
    <div id="waifu" style="left: 50%; transform: translateX(-50%); bottom: 0;">
        <div id="waifu-tips"></div>
        <div id="waifu-canvas">
            <canvas id="live2d" width="400" height="400"></canvas>
        </div>
    </div>

    <script type="module">
        const info = document.getElementById('load-info');
        const live2d_path = './1/dist/';

        async function init() {
            try {
                info.innerText = "正在加载样式...";
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = live2d_path + 'waifu.css';
                document.head.appendChild(link);

                info.innerText = "正在加载核心驱动 (live2d.min.js)...";
                await new Promise((resolve) => {
                    const script = document.createElement('script');
                    script.src = live2d_path + 'live2d.min.js';
                    script.onload = resolve;
                    document.head.appendChild(script);
                });

                info.innerText = "正在导入逻辑模块 (waifu-tips.js)...";
                await import(live2d_path + 'waifu-tips.js');

                info.innerText = "正在执行初始化...";
                if (typeof window.initWidget === 'function') {
                    window.initWidget({
                        waifuPath: './waifu-tips.json',
                        cubism2Path: live2d_path + 'live2d.min.js',
                        // 移除 cdnPath，让它使用 waifu-tips.json 里的本地相对路径 (Pio/model.json)
                        tools: ['hitokoto', 'switch-model'],
                        logLevel: 'trace'
                    });
                    info.innerHTML = "<span style='color:#00ff00'>初始化成功！请确认屏幕中间是否出现看板娘。</span>";
                } else {
                    throw new Error("initWidget 未能在全局作用域找到");
                }
            } catch (e) {
                console.error(e);
                info.innerHTML = `<span style='color:#ff5555'>错误：${e.message}。请确保通过 http:// 协议访问。</span>`;
            }
        }

        init();
    </script>
</body>
</html>
